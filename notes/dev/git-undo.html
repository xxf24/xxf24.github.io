<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Git 撤销操作 | 小凡の个人日志</title>
    <meta name="description" content="这个人很懒,什么描述都没有留下">
    <meta name="generator" content="VitePress v1.5.0">
    <link rel="preload stylesheet" href="/assets/style.cabtQgkj.css" as="style">
    <link rel="preload stylesheet" href="/vp-icons.css" as="style">
    <script type="module" src="/assets/chunks/metadata.c256a551.js"></script>
    <script type="module" src="/assets/app.DRyE6s1N.js"></script>
    <link rel="modulepreload" href="/assets/chunks/theme.B5CWaoPl.js">
    <link rel="modulepreload" href="/assets/chunks/framework.D5y5L8WJ.js">
    <link rel="modulepreload" href="/assets/notes_dev_git-undo.md.CZSiKgML.lean.js">
    <link rel="icon" href="/favicon.svg" type="image/svg+xml">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-af5a8e01><!--[--><!--]--><!--[--><span tabindex="-1" data-v-ea715ef4></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-ea715ef4> Skip to content </a><!--]--><!----><header class="VPNav" data-v-af5a8e01 data-v-02654c83><div class="VPNavBar" data-v-02654c83 data-v-320d41fb><div class="wrapper" data-v-320d41fb><div class="container" data-v-320d41fb><div class="title" data-v-320d41fb><div class="VPNavBarTitle has-sidebar" data-v-320d41fb data-v-c9ce47e3><a class="title" href="/" data-v-c9ce47e3><!--[--><!--]--><!--[--><!--[--><!--[--><img class="VPImage dark logo" src="/imgs/bonfire.jpg" alt data-v-79b95eb3><!--]--><!--[--><img class="VPImage light logo" src="/imgs/sherry.jpg" alt data-v-79b95eb3><!--]--><!--]--><!--]--><span data-v-c9ce47e3>小凡の个人日志</span><!--[--><!--]--></a></div></div><div class="content" data-v-320d41fb><div class="content-body" data-v-320d41fb><!--[--><!--]--><div class="VPNavBarSearch search" data-v-320d41fb><!----></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-320d41fb data-v-7edd65bc><span id="main-nav-aria-label" class="visually-hidden" data-v-7edd65bc> Main Navigation </span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/posts/" tabindex="0" data-v-7edd65bc data-v-69bc1d1a><!--[--><span data-v-69bc1d1a>日常</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink active" href="/notes/" tabindex="0" data-v-7edd65bc data-v-69bc1d1a><!--[--><span data-v-69bc1d1a>笔记</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/about" tabindex="0" data-v-7edd65bc data-v-69bc1d1a><!--[--><span data-v-69bc1d1a>关于</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-320d41fb data-v-91e0c0c0><button class="flex items-center justify-center p-3 rounded-full transition" hover="bg-black/5 dark:bg-white/10" data-v-91e0c0c0 data-v-cd929ef5><i class="icon-sun" data-v-cd929ef5></i></button></div><!----><div class="VPFlyout VPNavBarExtra extra" data-v-320d41fb data-v-7d4be520 data-v-aec0658f><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-aec0658f><span class="vpi-more-horizontal icon" data-v-aec0658f></span></button><div class="menu" data-v-aec0658f><div class="VPMenu" data-v-aec0658f data-v-f6065be7><!----><!--[--><!--[--><!----><div class="group" data-v-7d4be520><div class="item appearance" data-v-7d4be520><p class="label" data-v-7d4be520>深色模式</p><div class="appearance-action" data-v-7d4be520><button class="flex items-center justify-center p-3 rounded-full transition" hover="bg-black/5 dark:bg-white/10" data-v-7d4be520 data-v-cd929ef5><i class="icon-sun" data-v-cd929ef5></i></button></div></div></div><!----><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-320d41fb data-v-f5d2c593><span class="container" data-v-f5d2c593><span class="top" data-v-f5d2c593></span><span class="middle" data-v-f5d2c593></span><span class="bottom" data-v-f5d2c593></span></span></button></div></div></div></div><div class="divider" data-v-320d41fb><div class="divider-line" data-v-320d41fb></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-af5a8e01 data-v-5f89d84d><div class="container" data-v-5f89d84d><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-5f89d84d><span class="vpi-align-left menu-icon" data-v-5f89d84d></span><span class="menu-text" data-v-5f89d84d>目录</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-5f89d84d data-v-91d5c8eb><button data-v-91d5c8eb>返回顶部</button><!----></div></div></div><aside class="VPSidebar" data-v-af5a8e01 data-v-011becda><div class="curtain" data-v-011becda></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-011becda><span class="visually-hidden" id="sidebar-aria-label" data-v-011becda> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="no-transition group" data-v-102d1fb2><section class="VPSidebarItem level-0" data-v-102d1fb2 data-v-eb1f3bb0><!----><div class="items" data-v-eb1f3bb0><!--[--><div class="VPSidebarItem level-1 is-link" data-v-eb1f3bb0 data-v-eb1f3bb0><div class="item" data-v-eb1f3bb0><div class="indicator" data-v-eb1f3bb0></div><a class="VPLink link link" href="/notes" data-v-eb1f3bb0><!--[--><p class="text" data-v-eb1f3bb0>🔍 目录</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-102d1fb2><section class="VPSidebarItem level-0 collapsible" data-v-102d1fb2 data-v-eb1f3bb0><div class="item" role="button" tabindex="0" data-v-eb1f3bb0><div class="indicator" data-v-eb1f3bb0></div><h2 class="text" data-v-eb1f3bb0>🎯 练习</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-eb1f3bb0><span class="vpi-chevron-right caret-icon" data-v-eb1f3bb0></span></div></div><div class="items" data-v-eb1f3bb0><!--[--><div class="VPSidebarItem level-1 is-link" data-v-eb1f3bb0 data-v-eb1f3bb0><div class="item" data-v-eb1f3bb0><div class="indicator" data-v-eb1f3bb0></div><a class="VPLink link link" href="/notes/ep/game-life" data-v-eb1f3bb0><!--[--><p class="text" data-v-eb1f3bb0>康威生命游戏</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-eb1f3bb0 data-v-eb1f3bb0><div class="item" data-v-eb1f3bb0><div class="indicator" data-v-eb1f3bb0></div><a class="VPLink link link" href="/notes/ep/sliding-puzzle" data-v-eb1f3bb0><!--[--><p class="text" data-v-eb1f3bb0>滑动拼图</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-eb1f3bb0 data-v-eb1f3bb0><div class="item" data-v-eb1f3bb0><div class="indicator" data-v-eb1f3bb0></div><a class="VPLink link link" href="/notes/ep/2048" data-v-eb1f3bb0><!--[--><p class="text" data-v-eb1f3bb0>2048</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-eb1f3bb0 data-v-eb1f3bb0><div class="item" data-v-eb1f3bb0><div class="indicator" data-v-eb1f3bb0></div><a class="VPLink link link" href="/notes/ep/minesweeper" data-v-eb1f3bb0><!--[--><p class="text" data-v-eb1f3bb0>扫雷</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-102d1fb2><section class="VPSidebarItem level-0 collapsible" data-v-102d1fb2 data-v-eb1f3bb0><div class="item" role="button" tabindex="0" data-v-eb1f3bb0><div class="indicator" data-v-eb1f3bb0></div><h2 class="text" data-v-eb1f3bb0>🙋‍♂️ 问答</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-eb1f3bb0><span class="vpi-chevron-right caret-icon" data-v-eb1f3bb0></span></div></div><div class="items" data-v-eb1f3bb0><!--[--><div class="VPSidebarItem level-1 is-link" data-v-eb1f3bb0 data-v-eb1f3bb0><div class="item" data-v-eb1f3bb0><div class="indicator" data-v-eb1f3bb0></div><a class="VPLink link link" href="/notes/qa/float-sum" data-v-eb1f3bb0><!--[--><p class="text" data-v-eb1f3bb0>白话编程语言中的 0.1 + 0.2</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-eb1f3bb0 data-v-eb1f3bb0><div class="item" data-v-eb1f3bb0><div class="indicator" data-v-eb1f3bb0></div><a class="VPLink link link" href="/notes/qa/lunisolar" data-v-eb1f3bb0><!--[--><p class="text" data-v-eb1f3bb0>农历的“计算”方式解读</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-eb1f3bb0 data-v-eb1f3bb0><div class="item" data-v-eb1f3bb0><div class="indicator" data-v-eb1f3bb0></div><a class="VPLink link link" href="/notes/qa/n-queens" data-v-eb1f3bb0><!--[--><p class="text" data-v-eb1f3bb0>八皇后问题</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-102d1fb2><section class="VPSidebarItem level-0 collapsible has-active" data-v-102d1fb2 data-v-eb1f3bb0><div class="item" role="button" tabindex="0" data-v-eb1f3bb0><div class="indicator" data-v-eb1f3bb0></div><h2 class="text" data-v-eb1f3bb0>☕ 开发</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-eb1f3bb0><span class="vpi-chevron-right caret-icon" data-v-eb1f3bb0></span></div></div><div class="items" data-v-eb1f3bb0><!--[--><div class="VPSidebarItem level-1 is-link" data-v-eb1f3bb0 data-v-eb1f3bb0><div class="item" data-v-eb1f3bb0><div class="indicator" data-v-eb1f3bb0></div><a class="VPLink link link" href="/notes/dev/git-rebase" data-v-eb1f3bb0><!--[--><p class="text" data-v-eb1f3bb0>Git 变基操作</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-eb1f3bb0 data-v-eb1f3bb0><div class="item" data-v-eb1f3bb0><div class="indicator" data-v-eb1f3bb0></div><a class="VPLink link link" href="/notes/dev/git-merge" data-v-eb1f3bb0><!--[--><p class="text" data-v-eb1f3bb0>Git 分支合并</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-eb1f3bb0 data-v-eb1f3bb0><div class="item" data-v-eb1f3bb0><div class="indicator" data-v-eb1f3bb0></div><a class="VPLink link link" href="/notes/dev/git-undo" data-v-eb1f3bb0><!--[--><p class="text" data-v-eb1f3bb0>Git 撤销操作</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-eb1f3bb0 data-v-eb1f3bb0><div class="item" data-v-eb1f3bb0><div class="indicator" data-v-eb1f3bb0></div><a class="VPLink link link" href="/notes/dev/ts-type-challenges" data-v-eb1f3bb0><!--[--><p class="text" data-v-eb1f3bb0>TypeScript 类型挑战</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-eb1f3bb0 data-v-eb1f3bb0><div class="item" data-v-eb1f3bb0><div class="indicator" data-v-eb1f3bb0></div><a class="VPLink link link" href="/notes/dev/ts-type-gym" data-v-eb1f3bb0><!--[--><p class="text" data-v-eb1f3bb0>TypeScript 类型体操</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-eb1f3bb0 data-v-eb1f3bb0><div class="item" data-v-eb1f3bb0><div class="indicator" data-v-eb1f3bb0></div><a class="VPLink link link" href="/notes/dev/ts-handbook" data-v-eb1f3bb0><!--[--><p class="text" data-v-eb1f3bb0>TypeScript 官网手册</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-af5a8e01 data-v-9cf249e0><div class="VPDoc has-sidebar has-aside" data-v-9cf249e0 data-v-8f1090bb><!--[--><!--]--><div class="container" data-v-8f1090bb><div class="aside" data-v-8f1090bb><div class="aside-curtain" data-v-8f1090bb></div><div class="aside-container" data-v-8f1090bb><div class="aside-content" data-v-8f1090bb><div class="VPDocAside" data-v-8f1090bb data-v-5f23e149><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-5f23e149 data-v-af88022b><div class="content" data-v-af88022b><div class="outline-marker" data-v-af88022b></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-af88022b>在本页</div><ul class="VPDocOutlineItem root" data-v-af88022b data-v-086580d1><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-5f23e149></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-8f1090bb><div class="content-container" data-v-8f1090bb><!--[--><!--[--><!--[--><button class="fixed bottom-6 right-6 z-10 flex rounded-full p-3 text-base transition op-0! pointer-events-none" hover="op-100 bg-black/5 dark:bg-white/10" title="返回顶部"><i class="i-lucide-arrow-up"></i></button><div><header class="mb-7 flex flex-col"><h1 class="mb-4 text-3xl font-bold">Git 撤销操作</h1><ul class="flex flex-wrap gap-x-6 gap-y-2 text-sm text-$vp-c-text-2"><li class="flex items-center gap-1" title="首次发布日期"><i class="i-lucide-calendar"></i> Apr 6, 2023</li><li class="flex items-center gap-1" title="上次更新时间"><i class="i-lucide-file-pen"></i> 19 minutes ago</li><li class="flex items-center"><!--[--><!--[--><a href="/notes/#view=tags&amp;tag=git" class="transition hover:text-brand">git</a><!----><!--]--><!--]--><i class="i-lucide-tag order-first mr-1"></i></li></ul></header></div><!--]--><!--]--><!--]--><main class="main" data-v-8f1090bb><div style="position:relative;" class="vp-doc _notes_dev_git-undo external-link-icon-enabled" data-v-8f1090bb><div><p>在我刚接触 git 时，看到过这么一种说法：git 很强，只要文件被追踪，就不用担心出现丢失问题。</p><p>日常使用中，我确实感受到 git 功能的强大，但时不时也会面临一些困境。究其原因，一方面是相关的命令太多，操作起来有一定的心智负担；另一方面还是担心会把历史提交或者已有改动给弄没了。</p><p>本文尝试归纳一些常见的撤销命令，以作备忘。</p><h2 id="reset-和-revert" tabindex="-1">reset 和 revert <a class="header-anchor" href="#reset-和-revert" aria-label="Permalink to &quot;reset 和 revert&quot;">​</a></h2><h3 id="辨析-git-reset-的选项" tabindex="-1">辨析 git reset 的选项 <a class="header-anchor" href="#辨析-git-reset-的选项" aria-label="Permalink to &quot;辨析 git reset 的选项&quot;">​</a></h3><p>git reset 用于将 HEAD 指针重置到指定的提交，根据传入选项的不同，会有不同的结果。常见有以下三种选项：</p><ul><li><code>--mixed</code> （默认选项）</li><li><code>--soft</code></li><li><code>--hard</code></li></ul><p>关于它们的区别，这里我动手实践了下：用以下 4 个文件来模拟 git 工作目录下文件可能的状态，然后执行 <code>git reset HEAD</code>，分别记录传入不同选项时的执行结果。</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> status</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -s</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">A</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  new.md</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 新添加到暂存区的文件</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">M</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  package.json</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # 有修改并且暂存的文件</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> M</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> readme.md</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     # 有修改但未暂存的文件</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">??</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> untracked.md  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 新添加的还没有被追踪的文件</span></span></code></pre></div><div class="vp-code-group vp-adaptive-theme"><div class="tabs"><input type="radio" name="group-2zhA7" id="tab-3wIm563" checked><label data-title="--mixed" for="tab-3wIm563">--mixed</label><input type="radio" name="group-2zhA7" id="tab-sch65ZG"><label data-title="--soft" for="tab-sch65ZG">--soft</label><input type="radio" name="group-2zhA7" id="tab-k334K0x"><label data-title="--hard" for="tab-k334K0x">--hard</label></div><div class="blocks"><div class="language-bash vp-adaptive-theme active"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> reset</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> HEAD</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Unstaged</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> changes</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> after</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> reset:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">M</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">       package.json</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">M</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">       readme.md</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> status</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -s</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> M</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> package.json</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> M</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> readme.md</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">??</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> new.md</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">??</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> untracked.md</span></span></code></pre></div><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> reset</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --soft</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> HEAD</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> status</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -s</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">A</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  new.md</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">M</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  package.json</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> M</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> readme.md</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">??</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> untracked.md</span></span></code></pre></div><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> reset</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --hard</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> HEAD</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">HEAD</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> is</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> now</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> at</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ...</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> status</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -s</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">??</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> untracked.md</span></span></code></pre></div></div></div><p>将结果汇总如下：</p><table tabindex="0"><thead><tr><th>文件名</th><th>操作前状态</th><th><code>--mixed</code></th><th><code>--soft</code></th><th><code>--hard</code></th></tr></thead><tbody><tr><td>package.json</td><td>修改后已暂存</td><td>🧹 修改后未暂存</td><td>无变化</td><td>✂️ 修改会被删</td></tr><tr><td>readme.md</td><td>修改后未暂存</td><td>无变化</td><td>无变化</td><td>✂️ 修改会被删</td></tr><tr><td>new.md</td><td>新添加已暂存</td><td>🧹 新添加未暂存</td><td>无变化</td><td>❌️ 文件会被删</td></tr><tr><td>untracked.md</td><td>新添加未暂存</td><td>无变化</td><td>无变化</td><td>无变化</td></tr></tbody></table><p>简而言之：</p><ul><li>从影响范围看，这三者都只影响已经被 git 追踪的文件</li><li>从操作风险看，只有 <code>--hard</code> 选项会导致改动或者文件被删</li><li>相比 <code>--soft</code> 选项， 默认选项 <code>--mixed</code> 会清空暂存区</li></ul><p>另外，还有两种不太常见的选项：</p><ul><li><code>--keep</code></li><li><code>--merge</code></li></ul><h3 id="关于-git-revert" tabindex="-1">关于 git revert <a class="header-anchor" href="#关于-git-revert" aria-label="Permalink to &quot;关于 git revert&quot;">​</a></h3><p>区别于 reset 命令，使用 revert 不会影响已有的提交记录，而是在反转指定的提交后，再创建一个新的提交记录，像是在提交记录上打了一个新的补丁，可能不好看但是稳定方便。</p><p>默认情况下使用 revert 后会自动创建一个新的提交来反转指定的更改。我们可以添加 <code>-no-commit</code> 选项（或者缩写形式 <code>-n</code>）来禁止这种行为。</p><p>另外，使用 revert 后若自动提交失败则表示有文件冲突，需要我们手动合并。</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 撤销最近的提交</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> revert</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> HEAD</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 根据提交记录sha值撤销指定的提交</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> revert</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> commit-id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 按范围撤销</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 比如撤销master分支上倒数第五次到倒数第二次（包含）之间的所有提交</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 也可以用对应sha值代替master~5，注意不要写错起始顺序</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> revert</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> master~5..master~2</span></span></code></pre></div><h3 id="撤销刚刚的-撤销" tabindex="-1">撤销刚刚的“撤销” <a class="header-anchor" href="#撤销刚刚的-撤销" aria-label="Permalink to &quot;撤销刚刚的“撤销”&quot;">​</a></h3><p>如果在执行 <code>git reset</code> 后需要撤销，可以考虑命令 <code>git reset &lt;commit-id&gt;</code>，其中，<code>commit-id</code> 可以通过 <code>git reflog</code> 来查找（但 git 仅保留本地 90 天内的提交记录）。</p><p>而执行 <code>git revert</code> 后的撤销就相对简单一些，再执行一次 <code>git revert</code> 即可。</p><h2 id="clean-和-rm" tabindex="-1">clean 和 rm <a class="header-anchor" href="#clean-和-rm" aria-label="Permalink to &quot;clean 和 rm&quot;">​</a></h2><p>二者都可以用来删除工作目录下的文件，区别在于它们的操作对象不同。</p><p><code>git clean</code> 仅针对未被 git 追踪的文件，而 <code>git rm</code> 则针对已被 git 追踪的文件。</p><p>相关命令：</p><ul><li><code>git clean -n</code>： 展示给用户看哪些文件会被删除，并不会真的执行</li><li><code>git clean -f</code>： 请谨慎使用任何一个 <code>-f</code> 选项 避免误删</li><li><code>git clean -df</code>： <code>-d</code> 表示目录 删除未被追踪的空目录</li><li><code>git clean -dfx</code>：删除所有没有被跟踪的文件和目录 包括那些被忽略的文件</li></ul><hr><ul><li><code>git rm &lt;filepath&gt;</code>： 将文件从工作目录中删除，仅当文件没有更改时有效</li><li><code>git rm -f &lt;filepath&gt;</code>： 强制将文件从工作区和暂存区中删除，即使文件有未提交的修改</li><li><code>git rm --cached &lt;filepath&gt;</code>： 将文件从暂存区中删除，但保留在工作目录中</li><li><code>git rm -r &lt;dir-path&gt;</code>： 递归地将目录及其子目录下的所有文件从工作目录和暂存区中删除</li></ul><h2 id="checkout-和-restore" tabindex="-1">checkout 和 restore <a class="header-anchor" href="#checkout-和-restore" aria-label="Permalink to &quot;checkout 和 restore&quot;">​</a></h2><p>使用 <code>git checkout &lt;filepath&gt;</code> 可以将工作目录下已经改动的指定文件恢复成上次提交的状态，这意味着它会丢失其中未暂存的更改，有一定风险。</p><p>另外考虑到 checkout 命令还有操作分支的用法，Git 在 2.23 版本中（2019 年 8 月发布）引入了新的 <code>git restore</code> 命令用于文件恢复操作。</p><p>相关命令：</p><ul><li><code>git restore &lt;filepath&gt; --staged</code>：将文件从暂存区域移出</li><li><code>git restore &lt;filepath&gt;</code>：将文件恢复到上次提交时的状态，同 git checkout</li><li><code>git restore .</code>：还原工作目录下所有未暂存的文件</li><li><code>git restore &#39;*.js</code>：还原所有扩展名为 .js 的文件的内容</li><li><code>git restore --source=&lt;commit&gt; &lt;filepath&gt;</code>：还原文件到指定的某次提交</li></ul><h2 id="小结" tabindex="-1">小结 <a class="header-anchor" href="#小结" aria-label="Permalink to &quot;小结&quot;">​</a></h2><h3 id="撤销-git-add-的备选方案" tabindex="-1">撤销 git add 的备选方案 <a class="header-anchor" href="#撤销-git-add-的备选方案" aria-label="Permalink to &quot;撤销 git add 的备选方案&quot;">​</a></h3><ul><li><code>git restore --staged &lt;filepath&gt;</code>： 将暂存区指定文件恢复到工作目录</li><li><code>git restore --staged .</code>： 将暂存区所有文件恢复到工作目录</li><li><code>git reset &lt;filepath&gt;</code>： 将暂存区指定文件移除</li><li><code>git reset .</code>： 将暂存区所有文件移除</li><li><code>git rm --cached &lt;filepath&gt;</code>： 将暂存区指定文件移除</li></ul><h3 id="撤销-git-commit-的备选方案" tabindex="-1">撤销 git commit 的备选方案 <a class="header-anchor" href="#撤销-git-commit-的备选方案" aria-label="Permalink to &quot;撤销 git commit 的备选方案&quot;">​</a></h3><ul><li><code>git revert &lt;commit-id&gt;</code>： 创建一个新的提交，用于撤销指定提交的修改</li><li><code>git reset --soft &lt;commit-id&gt;</code>： 将当前分支重置到指定提交，并将修改放到暂存区</li><li><code>git reset &lt;commit-id&gt;</code>： 将当前分支重置到指定提交，并将修改放到工作目录</li><li><code>git reset --hard &lt;commit-id&gt;</code>： 将当前分支重置到指定提交，并丢弃所有修改</li></ul><h3 id="撤销-git-push-的备选方案" tabindex="-1">撤销 git push 的备选方案 <a class="header-anchor" href="#撤销-git-push-的备选方案" aria-label="Permalink to &quot;撤销 git push 的备选方案&quot;">​</a></h3><ul><li><code>git revert &lt;commit-id&gt;</code>： 创建一个新的提交，用于撤销指定的提交，并将其推送到远程分支</li><li><code>git reset --hard &lt;commit-id&gt;</code>： 将当前分支重置到指定提交，并丢弃所有修改，然后强制推送，但这会影响远程分支的提交记录历史，不建议在有多人协作的仓库上使用</li><li><code>git rebase -i &lt;commit-id&gt;</code>： 将当前分支的提交记录重新排序、编辑或删除，然后强制推送，这会改变提交记录的顺序，还是不建议在多人协作的仓库上使用</li></ul><h2 id="情景模拟" tabindex="-1">情景模拟 <a class="header-anchor" href="#情景模拟" aria-label="Permalink to &quot;情景模拟&quot;">​</a></h2><h3 id="情景一" tabindex="-1">情景一 <a class="header-anchor" href="#情景一" aria-label="Permalink to &quot;情景一&quot;">​</a></h3><blockquote><p>假设我修改一些了文件并且添加到暂存区，但没有执行提交，后续误操作将这些文件从硬盘上删除了，那么我的修改还能找回吗？</p></blockquote><p>可以使用 <code>git fsck --lost-found</code> 命令，这会显示将所有未引用的对象（包括暂存的文件），比如：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">dangling</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> blob</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> adb42b2f0dd6c5bb52be6049bd63fb3e14eef86f</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">dangling</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> blob</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 7e491fa4f8a4f4879b87a29e911ed2b50f7b83a8</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">dangling</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> blob</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a906cb2a4a904a152e80877d4088654daad0c859</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">...</span></span></code></pre></div><p>运行 <code>git show &lt;blob hash&gt;</code> 命令，可以查看对应 blob hash 对象的内容，如果确认是要恢复的文件，可以执行 <code>git cat-file -p adb42b2f0dd6c5bb52be6049bd63fb3e14eef86f &gt; &lt;filepath&gt;</code> 将内容写入到指定的路径中，或者直接浏览工作目录下的 .git/lost-found 目录，上述所有内容都会被写入到该目录下。</p><div class="tip custom-block github-alert"><p class="custom-block-title">TIP</p><p></p><p>本地改动后及时提交，不用担心会有冗长的提交记录，在推送前稍微 &quot;打平&quot; 即可</p></div><h3 id="情景二" tabindex="-1">情景二 <a class="header-anchor" href="#情景二" aria-label="Permalink to &quot;情景二&quot;">​</a></h3><blockquote><p>假设我误将一些敏感文件提交到了远程仓库，该如何撤回，且最好在远程分支上不留痕迹？</p></blockquote><p>撤回可参考小结中 git push 的备选方案。但想要不留痕迹，意味着需要修改提交历史，得使用强制推送。这其实相当麻烦，特别时有其他人也在推送，或者自己没有强推的权限，这些都需要额外的沟通成本。</p><div class="tip custom-block github-alert"><p class="custom-block-title">TIP</p><p>在向公共仓库 push 代码前，相比于为可能出现的错误的提交买单，多检查一下要提交的文件总是值得的。</p></div><h2 id="后记" tabindex="-1">后记 <a class="header-anchor" href="#后记" aria-label="Permalink to &quot;后记&quot;">​</a></h2><p>我发现在日常使用中，遇到问题时向 <code>ChatGPT</code> 或者 <code>new bing</code> 求助，也能获得一些不错的解决方案，尤其是当自己毫无头绪的时候 🤔。</p></div></div></main><div data-v-8f1090bb></div><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div></div>
    
    
  </body>
</html>